<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  
    <title>Splitting Date Ranges</title>
  
    <!-- CSS -->
    <link rel="stylesheet" href="/css/poole.css">
    <link rel="stylesheet" href="/css/syntax.css">
    <link rel="stylesheet" href="/css/lanyon.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
    
    <!-- FSharp.Formatting Styles -->
    <link rel="stylesheet" type="text/css" media="screen" href="/fsharp.formatting/tooltips.css" />
  	<script type="text/javascript" src="/fsharp.formatting/tooltips.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
  
    <style type="text/css">
      table.pre td {
        border: none;
      }
      
      table.pre code {
        font: 9pt 'Droid Sans Mono',consolas,monospace;
      }
    </style>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-71283003-1', 'auto');
      ga('send', 'pageview');
    
    </script>
  
  </head>
  <body>
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

    <div class="sidebar" id="sidebar">
      <div class="sidebar-item">
        <p>My website - place where I share thoughts on programming</p>
      </div>
    
      <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="/blog/index.html">Blog</a>
        <a class="sidebar-nav-item" href="/about/index.html">About me</a>
        <a class="sidebar-nav-item" href=https://legacy.gitbook.com/@theimowski target="_blank">GitBook</a>
        <a class="sidebar-nav-item" href="/about/privacy/index.html">Privacy</a>
      </nav>
    
      <div class="sidebar-item">
        <p>Created with <a target="_blank" href="https://github.com/fsprojects/FsBlog">FsBlog</a> and <a target="_blank" href="http://lanyon.getpoole.com/">Lanyon</a></p>
        <p>&copy; Tomasz Heimowski, 2018.</p>
      </div>

    </div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">

          <h3 class="masthead-title">
            <a href="/index.html" title="Home">Tomasz Heimowski</a>
          </h3>
        </div>
      </div>

      <div class="container content">
        

<div class="post">
  <h1 class="post-title">Splitting Date Ranges</h1>
  
<p>The power and beauty of F# pattern matching are often underestimated.
To shine more light on them I decided to share code fragments which exercise pattern matching to deal with date ranges.
This will be a simple divide and conquer implementation for a workaround over poorly designed API.</p>
<!--more-->
<div class="message">
<p>This post is part of the <a href="https://sergeytihon.com/2017/10/22/f-advent-calendar-in-english-2017/">F# Advent Calendar 2017</a> initiative - make sure to go check out rest of posts as well.</p>
</div>
<h2>Background</h2>
<p>Lately, I've faced following issue at my work:</p>
<p>There was a third-party API over a documents database.
This API exposed a standard endpoint to search for documents which met specified criteria.
The problem was that at the database level, there was a global max limit of documents that could be returned, and the API didn't offer <strong>any way of paging results</strong>.</p>
<p>So whenever you'd look for documents, and there were more documents meeting the search criteria than the global limit, you were basically <strong>screwed</strong>.</p>
<p>To demonstrate the situation, let's consider following F# code:</p>
<blockquote>
<p>Note: code presented in this post has no dependencies, so you should be able copy &amp; run in FSI (F# Interactive) 4.1 no problem.</p>
</blockquote>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">System</span>

<span class="k">module</span> <span class="t">ThirdPartyApi</span> <span class="o">=</span>

  <span class="k">type</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="t">DocType</span> <span class="o">=</span>
  | <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="p">DocTypeA</span>
  | <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="p">DocTypeB</span>
  | <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="p">DocTypeC</span>

  <span class="k">type</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="t">Document</span> <span class="o">=</span>
    { <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="i">DocId</span>   <span class="o">:</span> <span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="t">int</span>
      <span onmouseout="hideTip(event, 'fs9', 9)" onmouseover="showTip(event, 'fs9', 9)" class="i">Type</span>    <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 10)" onmouseover="showTip(event, 'fs2', 10)" class="t">DocType</span>
      <span onmouseout="hideTip(event, 'fs10', 11)" onmouseover="showTip(event, 'fs10', 11)" class="i">Created</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 12)" onmouseover="showTip(event, 'fs11', 12)" class="t">DateTimeOffset</span>
      <span onmouseout="hideTip(event, 'fs12', 13)" onmouseover="showTip(event, 'fs12', 13)" class="i">Content</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs13', 14)" onmouseover="showTip(event, 'fs13', 14)" class="t">string</span>
      <span class="c">(* more properties ... *)</span> }

  <span class="c">// 2000-01-01 00:00:00 UTC</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 15)" onmouseover="showTip(event, 'fs14', 15)" class="i">baseDate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 16)" onmouseover="showTip(event, 'fs11', 16)" class="t">DateTimeOffset</span>(<span class="n">2000</span>, <span class="n">1</span>, <span class="n">1</span>, <span class="n">0</span>, <span class="n">0</span>, <span class="n">0</span>, <span class="n">0</span>, <span onmouseout="hideTip(event, 'fs15', 17)" onmouseover="showTip(event, 'fs15', 17)" class="t">TimeSpan</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 18)" onmouseover="showTip(event, 'fs16', 18)" class="i">Zero</span>)

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 19)" onmouseover="showTip(event, 'fs17', 19)" class="i">documents</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 20)" onmouseover="showTip(event, 'fs6', 20)" class="t">Document</span> [] <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs18', 21)" onmouseover="showTip(event, 'fs18', 21)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 22)" onmouseover="showTip(event, 'fs19', 22)" class="f">init</span> <span class="n">100000</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs20', 23)" onmouseover="showTip(event, 'fs20', 23)" class="i">i</span> <span class="k">-&gt;</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 24)" onmouseover="showTip(event, 'fs21', 24)" class="i">index</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 25)" onmouseover="showTip(event, 'fs20', 25)" class="i">i</span> <span class="o">+</span> <span class="n">1</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 26)" onmouseover="showTip(event, 'fs22', 26)" class="i">typ</span> <span class="o">=</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs20', 27)" onmouseover="showTip(event, 'fs20', 27)" class="i">i</span> <span class="o">%</span> <span class="n">3</span> <span class="k">with</span>
        | <span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 28)" onmouseover="showTip(event, 'fs3', 28)" class="p">DocTypeA</span>
        | <span class="n">1</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 29)" onmouseover="showTip(event, 'fs4', 29)" class="p">DocTypeB</span>
        | <span class="n">2</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 30)" onmouseover="showTip(event, 'fs5', 30)" class="p">DocTypeC</span>
        | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs23', 31)" onmouseover="showTip(event, 'fs23', 31)" class="f">failwith</span> <span class="s">&quot;should not happen&quot;</span>

      { <span class="i">DocId</span>   <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 32)" onmouseover="showTip(event, 'fs21', 32)" class="i">index</span>
        <span onmouseout="hideTip(event, 'fs24', 33)" onmouseover="showTip(event, 'fs24', 33)" class="i">Type</span>    <span class="o">=</span> <span onmouseout="hideTip(event, 'fs22', 34)" onmouseover="showTip(event, 'fs22', 34)" class="i">typ</span>
        <span class="i">Created</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 35)" onmouseover="showTip(event, 'fs14', 35)" class="i">baseDate</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs15', 36)" onmouseover="showTip(event, 'fs15', 36)" class="t">TimeSpan</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 37)" onmouseover="showTip(event, 'fs25', 37)" class="f">FromHours</span> (<span onmouseout="hideTip(event, 'fs26', 38)" onmouseover="showTip(event, 'fs26', 38)" class="f">float</span> <span onmouseout="hideTip(event, 'fs21', 39)" onmouseover="showTip(event, 'fs21', 39)" class="i">index</span>)
        <span class="i">Content</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs27', 40)" onmouseover="showTip(event, 'fs27', 40)" class="f">sprintf</span> <span class="s">&quot;Document no. </span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs21', 41)" onmouseover="showTip(event, 'fs21', 41)" class="i">index</span> })
</code></pre></td>
</tr>
</table>
<p>This is a fake in-memory model of the documents database.
Each document has its id, type, content, and date of creation.
In reality, the documents have a lot of other properties.
We populate the array with 100K sample documents, each of which is created within an hour timespan.</p>
<p>We can now simulate the behavior of the mentioned search API with following:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">type</span> <span onmouseout="hideTip(event, 'fs28', 42)" onmouseover="showTip(event, 'fs28', 42)" class="t">Filters</span> <span class="o">=</span>
    { <span onmouseout="hideTip(event, 'fs29', 43)" onmouseover="showTip(event, 'fs29', 43)" class="i">Type</span>                 <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 44)" onmouseover="showTip(event, 'fs2', 44)" class="t">DocType</span> <span onmouseout="hideTip(event, 'fs30', 45)" onmouseover="showTip(event, 'fs30', 45)" class="t">option</span>
      <span onmouseout="hideTip(event, 'fs31', 46)" onmouseover="showTip(event, 'fs31', 46)" class="i">CreatedBeforeOrEqual</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 47)" onmouseover="showTip(event, 'fs11', 47)" class="t">DateTimeOffset</span> <span onmouseout="hideTip(event, 'fs30', 48)" onmouseover="showTip(event, 'fs30', 48)" class="t">option</span>
      <span onmouseout="hideTip(event, 'fs32', 49)" onmouseover="showTip(event, 'fs32', 49)" class="i">CreatedAfter</span>         <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 50)" onmouseover="showTip(event, 'fs11', 50)" class="t">DateTimeOffset</span> <span onmouseout="hideTip(event, 'fs30', 51)" onmouseover="showTip(event, 'fs30', 51)" class="t">option</span>
      <span class="c">(* more filters ... *)</span> }

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 52)" onmouseover="showTip(event, 'fs33', 52)" class="i">globalMaxLimit</span> <span class="o">=</span> <span class="n">1000</span>

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 53)" onmouseover="showTip(event, 'fs34', 53)" class="f">search</span> <span onmouseout="hideTip(event, 'fs35', 54)" onmouseover="showTip(event, 'fs35', 54)" class="i">filters</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs36', 55)" onmouseover="showTip(event, 'fs36', 55)" class="i">async</span> {
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 56)" onmouseover="showTip(event, 'fs37', 56)" class="i">results</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs17', 57)" onmouseover="showTip(event, 'fs17', 57)" class="i">documents</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs18', 58)" onmouseover="showTip(event, 'fs18', 58)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 59)" onmouseover="showTip(event, 'fs38', 59)" class="f">filter</span>
          (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs39', 60)" onmouseover="showTip(event, 'fs39', 60)" class="i">doc</span> <span class="k">-&gt;</span> 
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs35', 61)" onmouseover="showTip(event, 'fs35', 61)" class="i">filters</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 62)" onmouseover="showTip(event, 'fs40', 62)" class="i">Type</span> <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs41', 63)" onmouseover="showTip(event, 'fs41', 63)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs42', 64)" onmouseover="showTip(event, 'fs42', 64)" class="i">t</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs39', 65)" onmouseover="showTip(event, 'fs39', 65)" class="i">doc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 66)" onmouseover="showTip(event, 'fs43', 66)" class="i">Type</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs42', 67)" onmouseover="showTip(event, 'fs42', 67)" class="i">t</span> 
            | <span onmouseout="hideTip(event, 'fs44', 68)" onmouseover="showTip(event, 'fs44', 68)" class="p">None</span>   <span class="k">-&gt;</span> <span class="k">true</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs18', 69)" onmouseover="showTip(event, 'fs18', 69)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 70)" onmouseover="showTip(event, 'fs38', 70)" class="f">filter</span>
          (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs39', 71)" onmouseover="showTip(event, 'fs39', 71)" class="i">doc</span> <span class="k">-&gt;</span>
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs35', 72)" onmouseover="showTip(event, 'fs35', 72)" class="i">filters</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 73)" onmouseover="showTip(event, 'fs32', 73)" class="i">CreatedAfter</span> <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs41', 74)" onmouseover="showTip(event, 'fs41', 74)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs45', 75)" onmouseover="showTip(event, 'fs45', 75)" class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs39', 76)" onmouseover="showTip(event, 'fs39', 76)" class="i">doc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 77)" onmouseover="showTip(event, 'fs10', 77)" class="i">Created</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs45', 78)" onmouseover="showTip(event, 'fs45', 78)" class="i">a</span>
            | <span onmouseout="hideTip(event, 'fs44', 79)" onmouseover="showTip(event, 'fs44', 79)" class="p">None</span>   <span class="k">-&gt;</span> <span class="k">true</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs18', 80)" onmouseover="showTip(event, 'fs18', 80)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 81)" onmouseover="showTip(event, 'fs38', 81)" class="f">filter</span>
          (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs39', 82)" onmouseover="showTip(event, 'fs39', 82)" class="i">doc</span> <span class="k">-&gt;</span>
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs35', 83)" onmouseover="showTip(event, 'fs35', 83)" class="i">filters</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 84)" onmouseover="showTip(event, 'fs31', 84)" class="i">CreatedBeforeOrEqual</span> <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs41', 85)" onmouseover="showTip(event, 'fs41', 85)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs46', 86)" onmouseover="showTip(event, 'fs46', 86)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs39', 87)" onmouseover="showTip(event, 'fs39', 87)" class="i">doc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 88)" onmouseover="showTip(event, 'fs10', 88)" class="i">Created</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs46', 89)" onmouseover="showTip(event, 'fs46', 89)" class="i">b</span>
            | <span onmouseout="hideTip(event, 'fs44', 90)" onmouseover="showTip(event, 'fs44', 90)" class="p">None</span>   <span class="k">-&gt;</span> <span class="k">true</span>)

      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs37', 91)" onmouseover="showTip(event, 'fs37', 91)" class="i">results</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 92)" onmouseover="showTip(event, 'fs47', 92)" class="i">Length</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs33', 93)" onmouseover="showTip(event, 'fs33', 93)" class="i">globalMaxLimit</span> <span class="k">then</span>
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs18', 94)" onmouseover="showTip(event, 'fs18', 94)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 95)" onmouseover="showTip(event, 'fs48', 95)" class="f">take</span> <span onmouseout="hideTip(event, 'fs33', 96)" onmouseover="showTip(event, 'fs33', 96)" class="i">globalMaxLimit</span> <span onmouseout="hideTip(event, 'fs37', 97)" onmouseover="showTip(event, 'fs37', 97)" class="i">results</span>
      <span class="k">else</span>
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs37', 98)" onmouseover="showTip(event, 'fs37', 98)" class="i">results</span>
    }
</code></pre></td>
</tr>
</table>
<p>The relevant part of the snippet is the <code>globalMaxLimit</code> value (1000), and <code>search</code> result.
Note that no matter what filters you apply to the search, results get trimmed whenever they exceed the limit.</p>
<p>Let's see what happens if we try to find all <code>DocTypeA</code> documents:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 99)" onmouseover="showTip(event, 'fs49', 99)" class="i">onlyDocA</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs50', 100)" onmouseover="showTip(event, 'fs50', 100)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 101)" onmouseover="showTip(event, 'fs28', 101)" class="t">Filters</span> <span class="o">=</span>
  { <span onmouseout="hideTip(event, 'fs24', 102)" onmouseover="showTip(event, 'fs24', 102)" class="i">Type</span>                 <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 103)" onmouseover="showTip(event, 'fs41', 103)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs50', 104)" onmouseover="showTip(event, 'fs50', 104)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 105)" onmouseover="showTip(event, 'fs51', 105)" class="p">DocTypeA</span>
    <span class="i">CreatedBeforeOrEqual</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 106)" onmouseover="showTip(event, 'fs44', 106)" class="p">None</span>
    <span class="i">CreatedAfter</span>         <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 107)" onmouseover="showTip(event, 'fs44', 107)" class="p">None</span>  }

<span onmouseout="hideTip(event, 'fs50', 108)" onmouseover="showTip(event, 'fs50', 108)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 109)" onmouseover="showTip(event, 'fs52', 109)" class="f">search</span> <span onmouseout="hideTip(event, 'fs49', 110)" onmouseover="showTip(event, 'fs49', 110)" class="i">onlyDocA</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs53', 111)" onmouseover="showTip(event, 'fs53', 111)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 112)" onmouseover="showTip(event, 'fs54', 112)" class="f">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs55', 113)" onmouseover="showTip(event, 'fs55', 113)" class="i">results</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs56', 114)" onmouseover="showTip(event, 'fs56', 114)" class="f">printfn</span> <span class="s">&quot;Third Party Api results length: </span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs55', 115)" onmouseover="showTip(event, 'fs55', 115)" class="i">results</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 116)" onmouseover="showTip(event, 'fs47', 116)" class="i">Length</span>

<span class="c">// Third Party Api results length: 1000</span>
</code></pre></td>
</tr>
</table>
<p>We hit the max limit, and <strong>again</strong>: there's no way to page the results.</p>
<p>Leaving the API design without comments, let's see how we could workaround such limitation in F#.</p>
<h2>Solution</h2>
<p>As you may have noticed, each document has its own <code>created</code> timestamp.
Search filters allow to specify a date range when a document was created.</p>
<p>This means that we could take the original search definition filters and <strong>split</strong> a date range into two sub-ranges whenever max limit is exceeded.
Results for those two sub-ranges could be merged afterwards.</p>
<p>This idea is just another application of a known <a href="https://en.wikipedia.org/wiki/Divide_and_conquer_algorithm">Divide and conquer algorithm</a>.</p>
<p>Let's start with a type definition for a date range:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs57', 117)" onmouseover="showTip(event, 'fs57', 117)" class="t">DateRange</span> <span class="o">=</span>
| <span onmouseout="hideTip(event, 'fs58', 118)" onmouseover="showTip(event, 'fs58', 118)" class="p">Unbounded</span>
| <span onmouseout="hideTip(event, 'fs59', 119)" onmouseover="showTip(event, 'fs59', 119)" class="p">BeforeOrEqual</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs11', 120)" onmouseover="showTip(event, 'fs11', 120)" class="t">DateTimeOffset</span>
| <span onmouseout="hideTip(event, 'fs60', 121)" onmouseover="showTip(event, 'fs60', 121)" class="p">After</span>         <span class="k">of</span> <span onmouseout="hideTip(event, 'fs11', 122)" onmouseover="showTip(event, 'fs11', 122)" class="t">DateTimeOffset</span>
| <span onmouseout="hideTip(event, 'fs61', 123)" onmouseover="showTip(event, 'fs61', 123)" class="p">Between</span>       <span class="k">of</span> <span onmouseout="hideTip(event, 'fs11', 124)" onmouseover="showTip(event, 'fs11', 124)" class="t">DateTimeOffset</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs11', 125)" onmouseover="showTip(event, 'fs11', 125)" class="t">DateTimeOffset</span>
</code></pre></td>
</tr>
</table>
<p>The type is pretty self-explanatory.
What's also worth mentioning is that for the ranges we'll assume that:</p>
<ul>
<li>date after is always exclusive (after but not equal),</li>
<li>date before is always inclusive (before or equal) - hence the <code>OrEqual</code> suffix in case name.</li>
</ul>
<blockquote>
<p>Note: One may wonder why <a href="https://msdn.microsoft.com/pl-pl/library/system.datetimeoffset(v=vs.110).aspx">DateTimeOffset</a> is used instead of <a href="https://msdn.microsoft.com/pl-pl/library/system.datetime(v=vs.110).aspx">DateTime</a>. <a href="https://docs.microsoft.com/en-us/dotnet/standard/datetime/choosing-between-datetime">MSDN</a> suggests that in most scenarios you should default to the first one, and that's what I usually tend to do as this structure is more explicit.</p>
</blockquote>
<p>Using <code>DateRange</code> we can declare <code>split</code> function:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs62', 126)" onmouseover="showTip(event, 'fs62', 126)" class="t">Result</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span>,<span class="o">&#39;</span><span class="i">b</span><span class="o">&gt;</span> <span class="o">=</span>
| <span onmouseout="hideTip(event, 'fs63', 127)" onmouseover="showTip(event, 'fs63', 127)" class="p">Ok</span>    <span class="k">of</span> <span class="o">&#39;</span><span class="i">a</span>
| <span onmouseout="hideTip(event, 'fs64', 128)" onmouseover="showTip(event, 'fs64', 128)" class="p">Error</span> <span class="k">of</span> <span class="o">&#39;</span><span class="i">b</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs65', 129)" onmouseover="showTip(event, 'fs65', 129)" class="t">NoLimitSearchError</span> <span class="o">=</span>
| <span onmouseout="hideTip(event, 'fs66', 130)" onmouseover="showTip(event, 'fs66', 130)" class="p">MinDateAfterNow</span>     <span class="k">of</span> <span class="i">minDate</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 131)" onmouseover="showTip(event, 'fs11', 131)" class="t">DateTimeOffset</span> <span class="o">*</span> <span class="i">now</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 132)" onmouseover="showTip(event, 'fs11', 132)" class="t">DateTimeOffset</span>
| <span onmouseout="hideTip(event, 'fs67', 133)" onmouseover="showTip(event, 'fs67', 133)" class="p">MinTimeSpanExceeded</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs15', 134)" onmouseover="showTip(event, 'fs15', 134)" class="t">TimeSpan</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 135)" onmouseover="showTip(event, 'fs68', 135)" class="i">minTimeSpan</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 136)" onmouseover="showTip(event, 'fs15', 136)" class="t">TimeSpan</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 137)" onmouseover="showTip(event, 'fs69', 137)" class="f">FromSeconds</span> <span class="n">1.0</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 138)" onmouseover="showTip(event, 'fs70', 138)" class="f">midBetween</span> (<span onmouseout="hideTip(event, 'fs71', 139)" onmouseover="showTip(event, 'fs71', 139)" class="i">dateA</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 140)" onmouseover="showTip(event, 'fs11', 140)" class="t">DateTimeOffset</span>) (<span onmouseout="hideTip(event, 'fs72', 141)" onmouseover="showTip(event, 'fs72', 141)" class="i">dateB</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 142)" onmouseover="showTip(event, 'fs11', 142)" class="t">DateTimeOffset</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs73', 143)" onmouseover="showTip(event, 'fs73', 143)" class="i">diff</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs72', 144)" onmouseover="showTip(event, 'fs72', 144)" class="i">dateB</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs71', 145)" onmouseover="showTip(event, 'fs71', 145)" class="i">dateA</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs74', 146)" onmouseover="showTip(event, 'fs74', 146)" class="i">halfDiff</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 147)" onmouseover="showTip(event, 'fs15', 147)" class="t">TimeSpan</span>(<span onmouseout="hideTip(event, 'fs73', 148)" onmouseover="showTip(event, 'fs73', 148)" class="i">diff</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs75', 149)" onmouseover="showTip(event, 'fs75', 149)" class="i">Ticks</span> <span class="o">/</span> <span class="n">2L</span>)
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs74', 150)" onmouseover="showTip(event, 'fs74', 150)" class="i">halfDiff</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs68', 151)" onmouseover="showTip(event, 'fs68', 151)" class="i">minTimeSpan</span> <span class="k">then</span>
    <span onmouseout="hideTip(event, 'fs64', 152)" onmouseover="showTip(event, 'fs64', 152)" class="p">Error</span> (<span onmouseout="hideTip(event, 'fs67', 153)" onmouseover="showTip(event, 'fs67', 153)" class="p">MinTimeSpanExceeded</span> <span onmouseout="hideTip(event, 'fs68', 154)" onmouseover="showTip(event, 'fs68', 154)" class="i">minTimeSpan</span>)
  <span class="k">else</span>
    <span onmouseout="hideTip(event, 'fs63', 155)" onmouseover="showTip(event, 'fs63', 155)" class="p">Ok</span> (<span onmouseout="hideTip(event, 'fs71', 156)" onmouseover="showTip(event, 'fs71', 156)" class="i">dateA</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs74', 157)" onmouseover="showTip(event, 'fs74', 157)" class="i">halfDiff</span>)

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs76', 158)" onmouseover="showTip(event, 'fs76', 158)" class="f">getNowDate</span> () <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs11', 159)" onmouseover="showTip(event, 'fs11', 159)" class="t">DateTimeOffset</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 160)" onmouseover="showTip(event, 'fs77', 160)" class="i">UtcNow</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs78', 161)" onmouseover="showTip(event, 'fs78', 161)" class="f">split</span> <span onmouseout="hideTip(event, 'fs79', 162)" onmouseover="showTip(event, 'fs79', 162)" class="i">minDate</span> <span onmouseout="hideTip(event, 'fs80', 163)" onmouseover="showTip(event, 'fs80', 163)" class="i">range</span> <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs81', 164)" onmouseover="showTip(event, 'fs81', 164)" class="i">now</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs76', 165)" onmouseover="showTip(event, 'fs76', 165)" class="f">getNowDate</span>()
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs79', 166)" onmouseover="showTip(event, 'fs79', 166)" class="i">minDate</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs81', 167)" onmouseover="showTip(event, 'fs81', 167)" class="i">now</span> <span class="k">then</span>
    <span onmouseout="hideTip(event, 'fs64', 168)" onmouseover="showTip(event, 'fs64', 168)" class="p">Error</span> (<span onmouseout="hideTip(event, 'fs66', 169)" onmouseover="showTip(event, 'fs66', 169)" class="p">MinDateAfterNow</span> (<span onmouseout="hideTip(event, 'fs79', 170)" onmouseover="showTip(event, 'fs79', 170)" class="i">minDate</span>, <span onmouseout="hideTip(event, 'fs81', 171)" onmouseover="showTip(event, 'fs81', 171)" class="i">now</span>))
  <span class="k">else</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs71', 172)" onmouseover="showTip(event, 'fs71', 172)" class="i">dateA</span>, <span onmouseout="hideTip(event, 'fs72', 173)" onmouseover="showTip(event, 'fs72', 173)" class="i">dateB</span> <span class="o">=</span>
      <span class="k">match</span> <span onmouseout="hideTip(event, 'fs80', 174)" onmouseover="showTip(event, 'fs80', 174)" class="i">range</span> <span class="k">with</span>
      | <span onmouseout="hideTip(event, 'fs58', 175)" onmouseover="showTip(event, 'fs58', 175)" class="p">Unbounded</span>       <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs79', 176)" onmouseover="showTip(event, 'fs79', 176)" class="i">minDate</span>, <span onmouseout="hideTip(event, 'fs81', 177)" onmouseover="showTip(event, 'fs81', 177)" class="i">now</span>
      | <span onmouseout="hideTip(event, 'fs59', 178)" onmouseover="showTip(event, 'fs59', 178)" class="p">BeforeOrEqual</span> <span onmouseout="hideTip(event, 'fs46', 179)" onmouseover="showTip(event, 'fs46', 179)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs79', 180)" onmouseover="showTip(event, 'fs79', 180)" class="i">minDate</span>, <span onmouseout="hideTip(event, 'fs46', 181)" onmouseover="showTip(event, 'fs46', 181)" class="i">b</span>
      | <span onmouseout="hideTip(event, 'fs60', 182)" onmouseover="showTip(event, 'fs60', 182)" class="p">After</span> <span onmouseout="hideTip(event, 'fs45', 183)" onmouseover="showTip(event, 'fs45', 183)" class="i">a</span>         <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs45', 184)" onmouseover="showTip(event, 'fs45', 184)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs81', 185)" onmouseover="showTip(event, 'fs81', 185)" class="i">now</span>
      | <span onmouseout="hideTip(event, 'fs61', 186)" onmouseover="showTip(event, 'fs61', 186)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs46', 187)" onmouseover="showTip(event, 'fs46', 187)" class="i">b</span>, <span onmouseout="hideTip(event, 'fs45', 188)" onmouseover="showTip(event, 'fs45', 188)" class="i">a</span>)  <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs46', 189)" onmouseover="showTip(event, 'fs46', 189)" class="i">b</span>, <span onmouseout="hideTip(event, 'fs45', 190)" onmouseover="showTip(event, 'fs45', 190)" class="i">a</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs82', 191)" onmouseover="showTip(event, 'fs82', 191)" class="f">dates</span> <span onmouseout="hideTip(event, 'fs83', 192)" onmouseover="showTip(event, 'fs83', 192)" class="i">mid</span> <span class="o">=</span>
      <span class="k">match</span> <span onmouseout="hideTip(event, 'fs80', 193)" onmouseover="showTip(event, 'fs80', 193)" class="i">range</span> <span class="k">with</span>
      | <span onmouseout="hideTip(event, 'fs58', 194)" onmouseover="showTip(event, 'fs58', 194)" class="p">Unbounded</span>       <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs59', 195)" onmouseover="showTip(event, 'fs59', 195)" class="p">BeforeOrEqual</span> <span onmouseout="hideTip(event, 'fs83', 196)" onmouseover="showTip(event, 'fs83', 196)" class="i">mid</span>, <span onmouseout="hideTip(event, 'fs60', 197)" onmouseover="showTip(event, 'fs60', 197)" class="p">After</span> <span onmouseout="hideTip(event, 'fs83', 198)" onmouseover="showTip(event, 'fs83', 198)" class="i">mid</span>
      | <span onmouseout="hideTip(event, 'fs59', 199)" onmouseover="showTip(event, 'fs59', 199)" class="p">BeforeOrEqual</span> <span onmouseout="hideTip(event, 'fs46', 200)" onmouseover="showTip(event, 'fs46', 200)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs59', 201)" onmouseover="showTip(event, 'fs59', 201)" class="p">BeforeOrEqual</span> <span onmouseout="hideTip(event, 'fs83', 202)" onmouseover="showTip(event, 'fs83', 202)" class="i">mid</span>, <span onmouseout="hideTip(event, 'fs61', 203)" onmouseover="showTip(event, 'fs61', 203)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs83', 204)" onmouseover="showTip(event, 'fs83', 204)" class="i">mid</span>, <span onmouseout="hideTip(event, 'fs46', 205)" onmouseover="showTip(event, 'fs46', 205)" class="i">b</span>)
      | <span onmouseout="hideTip(event, 'fs60', 206)" onmouseover="showTip(event, 'fs60', 206)" class="p">After</span> <span onmouseout="hideTip(event, 'fs45', 207)" onmouseover="showTip(event, 'fs45', 207)" class="i">a</span>         <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs61', 208)" onmouseover="showTip(event, 'fs61', 208)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs45', 209)" onmouseover="showTip(event, 'fs45', 209)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs83', 210)" onmouseover="showTip(event, 'fs83', 210)" class="i">mid</span>), <span onmouseout="hideTip(event, 'fs60', 211)" onmouseover="showTip(event, 'fs60', 211)" class="p">After</span> <span onmouseout="hideTip(event, 'fs83', 212)" onmouseover="showTip(event, 'fs83', 212)" class="i">mid</span>
      | <span onmouseout="hideTip(event, 'fs61', 213)" onmouseover="showTip(event, 'fs61', 213)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs45', 214)" onmouseover="showTip(event, 'fs45', 214)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs46', 215)" onmouseover="showTip(event, 'fs46', 215)" class="i">b</span>)  <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs61', 216)" onmouseover="showTip(event, 'fs61', 216)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs45', 217)" onmouseover="showTip(event, 'fs45', 217)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs83', 218)" onmouseover="showTip(event, 'fs83', 218)" class="i">mid</span>), <span onmouseout="hideTip(event, 'fs61', 219)" onmouseover="showTip(event, 'fs61', 219)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs83', 220)" onmouseover="showTip(event, 'fs83', 220)" class="i">mid</span>, <span onmouseout="hideTip(event, 'fs46', 221)" onmouseover="showTip(event, 'fs46', 221)" class="i">b</span>)

    <span onmouseout="hideTip(event, 'fs70', 222)" onmouseover="showTip(event, 'fs70', 222)" class="f">midBetween</span> <span onmouseout="hideTip(event, 'fs71', 223)" onmouseover="showTip(event, 'fs71', 223)" class="i">dateA</span> <span onmouseout="hideTip(event, 'fs72', 224)" onmouseover="showTip(event, 'fs72', 224)" class="i">dateB</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs62', 225)" onmouseover="showTip(event, 'fs62', 225)" class="t">Result</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 226)" onmouseover="showTip(event, 'fs84', 226)" class="f">map</span> <span onmouseout="hideTip(event, 'fs82', 227)" onmouseover="showTip(event, 'fs82', 227)" class="i">dates</span>
</code></pre></td>
</tr>
</table>
<p>The <code>split</code> function takes a minimum date as first argument.
This helps restricting the date range, and is usually an easy to determine value.</p>
<p><code>NoLimitSearchError</code> is a type that declares possible failures:</p>
<ul>
<li><code>MinDateAfterNow</code> - happens whenever the minimum date is in the future</li>
<li><code>MinTimeSpanExceeded</code> - happens if by any chance there are more documents than global max limit created within minimum time span (one second in our case). The minium time span says that we cannot split any further a date range.</li>
</ul>
<p><code>midBetween</code> function computes a date between two other dates.</p>
<p>Inside <code>split</code> function, <code>dateA</code> and <code>dateB</code> stand for dates for which we'll compute a date in between.</p>
<p>Nested <code>dates</code> function takes a mid date and splits given range into two sub-ranges.</p>
<blockquote>
<p>Note: We're using <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/results">Result type</a> for denoting that function may return error. If you want to learn more about the approach, have a look into <a href="https://fsharpforfunandprofit.com/rop/">ROP</a> introduction. I added the definition of this type, so that tooltip engine can infer types correctly (Result type was introduced in F# 4.1)</p>
</blockquote>
<p>I'd like to pay your attention for a second to the <strong>beauty of pattern matching</strong> in above snippet. This was de-facto the reason why I decided to share this blog post in first place.</p>
<p>Note, how thanks to the <code>DateRange</code> DU we're easily able to specify relevant <code>split</code> logic.
For me personally, this is a <strong>big F# win</strong>.</p>
<h2>Wrapping it up</h2>
<p>Let's see how we can use the split function to define a workaround for the inital issue:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 228)" onmouseover="showTip(event, 'fs85', 228)" class="f">fromFilters</span> (<span onmouseout="hideTip(event, 'fs86', 229)" onmouseover="showTip(event, 'fs86', 229)" class="i">filters</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs50', 230)" onmouseover="showTip(event, 'fs50', 230)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 231)" onmouseover="showTip(event, 'fs28', 231)" class="t">Filters</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs87', 232)" onmouseover="showTip(event, 'fs87', 232)" class="i">before</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs86', 233)" onmouseover="showTip(event, 'fs86', 233)" class="i">filters</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 234)" onmouseover="showTip(event, 'fs88', 234)" class="i">CreatedBeforeOrEqual</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs89', 235)" onmouseover="showTip(event, 'fs89', 235)" class="i">after</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs86', 236)" onmouseover="showTip(event, 'fs86', 236)" class="i">filters</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 237)" onmouseover="showTip(event, 'fs90', 237)" class="i">CreatedAfter</span>

  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs87', 238)" onmouseover="showTip(event, 'fs87', 238)" class="i">before</span>, <span onmouseout="hideTip(event, 'fs89', 239)" onmouseover="showTip(event, 'fs89', 239)" class="i">after</span> <span class="k">with</span>
  | <span onmouseout="hideTip(event, 'fs41', 240)" onmouseover="showTip(event, 'fs41', 240)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs91', 241)" onmouseover="showTip(event, 'fs91', 241)" class="i">before</span>, <span onmouseout="hideTip(event, 'fs41', 242)" onmouseover="showTip(event, 'fs41', 242)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs92', 243)" onmouseover="showTip(event, 'fs92', 243)" class="i">after</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs61', 244)" onmouseover="showTip(event, 'fs61', 244)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs87', 245)" onmouseover="showTip(event, 'fs87', 245)" class="i">before</span>, <span onmouseout="hideTip(event, 'fs92', 246)" onmouseover="showTip(event, 'fs92', 246)" class="i">after</span>)
  | <span onmouseout="hideTip(event, 'fs41', 247)" onmouseover="showTip(event, 'fs41', 247)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs91', 248)" onmouseover="showTip(event, 'fs91', 248)" class="i">before</span>, <span onmouseout="hideTip(event, 'fs44', 249)" onmouseover="showTip(event, 'fs44', 249)" class="p">None</span>       <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs59', 250)" onmouseover="showTip(event, 'fs59', 250)" class="p">BeforeOrEqual</span> <span onmouseout="hideTip(event, 'fs91', 251)" onmouseover="showTip(event, 'fs91', 251)" class="i">before</span>
  | <span onmouseout="hideTip(event, 'fs44', 252)" onmouseover="showTip(event, 'fs44', 252)" class="p">None</span>, <span onmouseout="hideTip(event, 'fs41', 253)" onmouseover="showTip(event, 'fs41', 253)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs92', 254)" onmouseover="showTip(event, 'fs92', 254)" class="i">after</span>        <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs60', 255)" onmouseover="showTip(event, 'fs60', 255)" class="p">After</span> <span onmouseout="hideTip(event, 'fs92', 256)" onmouseover="showTip(event, 'fs92', 256)" class="i">after</span>
  | <span onmouseout="hideTip(event, 'fs44', 257)" onmouseover="showTip(event, 'fs44', 257)" class="p">None</span>, <span onmouseout="hideTip(event, 'fs44', 258)" onmouseover="showTip(event, 'fs44', 258)" class="p">None</span>              <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 259)" onmouseover="showTip(event, 'fs58', 259)" class="p">Unbounded</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 260)" onmouseover="showTip(event, 'fs93', 260)" class="f">apply</span> <span onmouseout="hideTip(event, 'fs80', 261)" onmouseover="showTip(event, 'fs80', 261)" class="i">range</span> (<span onmouseout="hideTip(event, 'fs86', 262)" onmouseover="showTip(event, 'fs86', 262)" class="i">filters</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs50', 263)" onmouseover="showTip(event, 'fs50', 263)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 264)" onmouseover="showTip(event, 'fs28', 264)" class="t">Filters</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 265)" onmouseover="showTip(event, 'fs86', 265)" class="i">filters</span> <span class="o">=</span>
    { <span onmouseout="hideTip(event, 'fs86', 266)" onmouseover="showTip(event, 'fs86', 266)" class="i">filters</span> <span class="k">with</span> 
        <span class="i">CreatedBeforeOrEqual</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 267)" onmouseover="showTip(event, 'fs44', 267)" class="p">None</span>
        <span class="i">CreatedAfter</span>         <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 268)" onmouseover="showTip(event, 'fs44', 268)" class="p">None</span> }

  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs80', 269)" onmouseover="showTip(event, 'fs80', 269)" class="i">range</span> <span class="k">with</span>
  | <span onmouseout="hideTip(event, 'fs58', 270)" onmouseover="showTip(event, 'fs58', 270)" class="p">Unbounded</span> <span class="k">-&gt;</span>
    <span onmouseout="hideTip(event, 'fs86', 271)" onmouseover="showTip(event, 'fs86', 271)" class="i">filters</span>
  | <span onmouseout="hideTip(event, 'fs59', 272)" onmouseover="showTip(event, 'fs59', 272)" class="p">BeforeOrEqual</span> <span onmouseout="hideTip(event, 'fs46', 273)" onmouseover="showTip(event, 'fs46', 273)" class="i">b</span> <span class="k">-&gt;</span>
    { <span onmouseout="hideTip(event, 'fs86', 274)" onmouseover="showTip(event, 'fs86', 274)" class="i">filters</span> <span class="k">with</span> <span class="i">CreatedBeforeOrEqual</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 275)" onmouseover="showTip(event, 'fs41', 275)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs46', 276)" onmouseover="showTip(event, 'fs46', 276)" class="i">b</span> }
  | <span onmouseout="hideTip(event, 'fs60', 277)" onmouseover="showTip(event, 'fs60', 277)" class="p">After</span> <span onmouseout="hideTip(event, 'fs45', 278)" onmouseover="showTip(event, 'fs45', 278)" class="i">a</span> <span class="k">-&gt;</span>
    { <span onmouseout="hideTip(event, 'fs86', 279)" onmouseover="showTip(event, 'fs86', 279)" class="i">filters</span> <span class="k">with</span> <span class="i">CreatedAfter</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 280)" onmouseover="showTip(event, 'fs41', 280)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs45', 281)" onmouseover="showTip(event, 'fs45', 281)" class="i">a</span> }
  | <span onmouseout="hideTip(event, 'fs61', 282)" onmouseover="showTip(event, 'fs61', 282)" class="p">Between</span> (<span onmouseout="hideTip(event, 'fs45', 283)" onmouseover="showTip(event, 'fs45', 283)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs46', 284)" onmouseover="showTip(event, 'fs46', 284)" class="i">b</span>) <span class="k">-&gt;</span>
    { <span onmouseout="hideTip(event, 'fs86', 285)" onmouseover="showTip(event, 'fs86', 285)" class="i">filters</span> <span class="k">with</span>
        <span class="i">CreatedAfter</span>         <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 286)" onmouseover="showTip(event, 'fs41', 286)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs45', 287)" onmouseover="showTip(event, 'fs45', 287)" class="i">a</span>
        <span class="i">CreatedBeforeOrEqual</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 288)" onmouseover="showTip(event, 'fs41', 288)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs46', 289)" onmouseover="showTip(event, 'fs46', 289)" class="i">b</span> }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs94', 290)" onmouseover="showTip(event, 'fs94', 290)" class="f">searchNoLimit</span> <span onmouseout="hideTip(event, 'fs79', 291)" onmouseover="showTip(event, 'fs79', 291)" class="i">minDate</span> <span onmouseout="hideTip(event, 'fs86', 292)" onmouseover="showTip(event, 'fs86', 292)" class="i">filters</span> <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs95', 293)" onmouseover="showTip(event, 'fs95', 293)" class="f">search</span> <span onmouseout="hideTip(event, 'fs80', 294)" onmouseover="showTip(event, 'fs80', 294)" class="i">range</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs36', 295)" onmouseover="showTip(event, 'fs36', 295)" class="i">async</span> {
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 296)" onmouseover="showTip(event, 'fs96', 296)" class="i">filters&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs93', 297)" onmouseover="showTip(event, 'fs93', 297)" class="f">apply</span> <span onmouseout="hideTip(event, 'fs80', 298)" onmouseover="showTip(event, 'fs80', 298)" class="i">range</span> <span onmouseout="hideTip(event, 'fs86', 299)" onmouseover="showTip(event, 'fs86', 299)" class="i">filters</span>
      <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs55', 300)" onmouseover="showTip(event, 'fs55', 300)" class="i">results</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs50', 301)" onmouseover="showTip(event, 'fs50', 301)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 302)" onmouseover="showTip(event, 'fs52', 302)" class="f">search</span> <span onmouseout="hideTip(event, 'fs96', 303)" onmouseover="showTip(event, 'fs96', 303)" class="i">filters&#39;</span>
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs55', 304)" onmouseover="showTip(event, 'fs55', 304)" class="i">results</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 305)" onmouseover="showTip(event, 'fs47', 305)" class="i">Length</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs50', 306)" onmouseover="showTip(event, 'fs50', 306)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 307)" onmouseover="showTip(event, 'fs33', 307)" class="i">globalMaxLimit</span> <span class="k">then</span>
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs63', 308)" onmouseover="showTip(event, 'fs63', 308)" class="p">Ok</span> <span onmouseout="hideTip(event, 'fs55', 309)" onmouseover="showTip(event, 'fs55', 309)" class="i">results</span>
      <span class="k">else</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs78', 310)" onmouseover="showTip(event, 'fs78', 310)" class="f">split</span> <span onmouseout="hideTip(event, 'fs79', 311)" onmouseover="showTip(event, 'fs79', 311)" class="i">minDate</span> <span onmouseout="hideTip(event, 'fs80', 312)" onmouseover="showTip(event, 'fs80', 312)" class="i">range</span> <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs63', 313)" onmouseover="showTip(event, 'fs63', 313)" class="p">Ok</span> (<span onmouseout="hideTip(event, 'fs97', 314)" onmouseover="showTip(event, 'fs97', 314)" class="i">firstRange</span>, <span onmouseout="hideTip(event, 'fs98', 315)" onmouseover="showTip(event, 'fs98', 315)" class="i">secondRange</span>) <span class="k">-&gt;</span>
          <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs99', 316)" onmouseover="showTip(event, 'fs99', 316)" class="i">results</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 317)" onmouseover="showTip(event, 'fs53', 317)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs100', 318)" onmouseover="showTip(event, 'fs100', 318)" class="f">Parallel</span> [| <span onmouseout="hideTip(event, 'fs95', 319)" onmouseover="showTip(event, 'fs95', 319)" class="f">search</span> <span onmouseout="hideTip(event, 'fs97', 320)" onmouseover="showTip(event, 'fs97', 320)" class="i">firstRange</span>; <span onmouseout="hideTip(event, 'fs95', 321)" onmouseover="showTip(event, 'fs95', 321)" class="f">search</span> <span onmouseout="hideTip(event, 'fs98', 322)" onmouseover="showTip(event, 'fs98', 322)" class="i">secondRange</span> |]
          <span class="k">match</span> <span onmouseout="hideTip(event, 'fs99', 323)" onmouseover="showTip(event, 'fs99', 323)" class="i">results</span> <span class="k">with</span>
          | [| <span onmouseout="hideTip(event, 'fs63', 324)" onmouseover="showTip(event, 'fs63', 324)" class="p">Ok</span> <span onmouseout="hideTip(event, 'fs101', 325)" onmouseover="showTip(event, 'fs101', 325)" class="i">a</span>; <span onmouseout="hideTip(event, 'fs63', 326)" onmouseover="showTip(event, 'fs63', 326)" class="p">Ok</span> <span onmouseout="hideTip(event, 'fs102', 327)" onmouseover="showTip(event, 'fs102', 327)" class="i">b</span> |] <span class="k">-&gt;</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs63', 328)" onmouseover="showTip(event, 'fs63', 328)" class="p">Ok</span> (<span onmouseout="hideTip(event, 'fs18', 329)" onmouseover="showTip(event, 'fs18', 329)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs103', 330)" onmouseover="showTip(event, 'fs103', 330)" class="f">append</span> <span onmouseout="hideTip(event, 'fs101', 331)" onmouseover="showTip(event, 'fs101', 331)" class="i">a</span> <span onmouseout="hideTip(event, 'fs102', 332)" onmouseover="showTip(event, 'fs102', 332)" class="i">b</span>)
          | [| <span onmouseout="hideTip(event, 'fs64', 333)" onmouseover="showTip(event, 'fs64', 333)" class="p">Error</span> <span onmouseout="hideTip(event, 'fs104', 334)" onmouseover="showTip(event, 'fs104', 334)" class="i">e</span>; _ |]
          | [| _; <span onmouseout="hideTip(event, 'fs64', 335)" onmouseover="showTip(event, 'fs64', 335)" class="p">Error</span> <span onmouseout="hideTip(event, 'fs104', 336)" onmouseover="showTip(event, 'fs104', 336)" class="i">e</span> |] <span class="k">-&gt;</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs64', 337)" onmouseover="showTip(event, 'fs64', 337)" class="p">Error</span> <span onmouseout="hideTip(event, 'fs104', 338)" onmouseover="showTip(event, 'fs104', 338)" class="i">e</span>
          | _                <span class="k">-&gt;</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs23', 339)" onmouseover="showTip(event, 'fs23', 339)" class="f">failwith</span> <span class="s">&quot;unexpected, array should have 2 elems&quot;</span>
        | <span onmouseout="hideTip(event, 'fs64', 340)" onmouseover="showTip(event, 'fs64', 340)" class="p">Error</span> <span onmouseout="hideTip(event, 'fs104', 341)" onmouseover="showTip(event, 'fs104', 341)" class="i">e</span> <span class="k">-&gt;</span>
          <span class="k">return</span> <span onmouseout="hideTip(event, 'fs64', 342)" onmouseover="showTip(event, 'fs64', 342)" class="p">Error</span> <span onmouseout="hideTip(event, 'fs104', 343)" onmouseover="showTip(event, 'fs104', 343)" class="i">e</span>
    }

  <span onmouseout="hideTip(event, 'fs95', 344)" onmouseover="showTip(event, 'fs95', 344)" class="f">search</span> (<span onmouseout="hideTip(event, 'fs85', 345)" onmouseover="showTip(event, 'fs85', 345)" class="f">fromFilters</span> <span onmouseout="hideTip(event, 'fs86', 346)" onmouseover="showTip(event, 'fs86', 346)" class="i">filters</span>)
</code></pre></td>
</tr>
</table>
<p>The <code>fromFilters</code> and <code>apply</code> functions serve as simple helpers to go from <code>ThirdPartyApi.Filters</code> to <code>DateRange</code> type and back. Once again, pattern matching proves helpful in both cases.</p>
<p>Most interesting part is the <code>searchNoLimit</code> function:</p>
<ul>
<li>nested <code>search</code> function takes a <code>DateRange</code> and invokes the original api,</li>
<li>if results are within the global limit we're good,</li>
<li>
otherwise split the <code>DateRange</code> and:
<ul>
<li>invoke <code>search</code> recursively in parallel for both sub-ranges, <code>firstRange</code> and <code>secondRange</code>,</li>
<li>append results of sub-ranges into single array.</li>
</ul>
</li>
</ul>
<p>Let's see if we can find now all <code>DocTypeA</code> documents:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs105', 347)" onmouseover="showTip(event, 'fs105', 347)" class="i">minDate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs50', 348)" onmouseover="showTip(event, 'fs50', 348)" class="t">ThirdPartyApi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 349)" onmouseover="showTip(event, 'fs14', 349)" class="i">baseDate</span>

<span class="k">match</span> <span onmouseout="hideTip(event, 'fs94', 350)" onmouseover="showTip(event, 'fs94', 350)" class="f">searchNoLimit</span> <span onmouseout="hideTip(event, 'fs105', 351)" onmouseover="showTip(event, 'fs105', 351)" class="i">minDate</span> <span onmouseout="hideTip(event, 'fs49', 352)" onmouseover="showTip(event, 'fs49', 352)" class="i">onlyDocA</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs53', 353)" onmouseover="showTip(event, 'fs53', 353)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 354)" onmouseover="showTip(event, 'fs54', 354)" class="f">RunSynchronously</span> <span class="k">with</span>
| <span onmouseout="hideTip(event, 'fs63', 355)" onmouseover="showTip(event, 'fs63', 355)" class="p">Ok</span> <span onmouseout="hideTip(event, 'fs55', 356)" onmouseover="showTip(event, 'fs55', 356)" class="i">results</span> <span class="k">-&gt;</span>
  <span onmouseout="hideTip(event, 'fs56', 357)" onmouseover="showTip(event, 'fs56', 357)" class="f">printfn</span> <span class="s">&quot;No Limit results length: </span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs55', 358)" onmouseover="showTip(event, 'fs55', 358)" class="i">results</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 359)" onmouseover="showTip(event, 'fs47', 359)" class="i">Length</span>
| <span onmouseout="hideTip(event, 'fs64', 360)" onmouseover="showTip(event, 'fs64', 360)" class="p">Error</span> <span onmouseout="hideTip(event, 'fs104', 361)" onmouseover="showTip(event, 'fs104', 361)" class="i">e</span> <span class="k">-&gt;</span>
  <span onmouseout="hideTip(event, 'fs56', 362)" onmouseover="showTip(event, 'fs56', 362)" class="f">printfn</span> <span class="s">&quot;No Limit failed with: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs104', 363)" onmouseover="showTip(event, 'fs104', 363)" class="i">e</span>

<span class="c">// No Limit results length: 33334</span>
</code></pre></td>
</tr>
</table>
<p>As expected, we get back now 1/3 of all documents from the database.</p>
<h2>Be aware</h2>
<p>The <code>searchNoLimit</code> function will invoke recursively until it's able to find all relevant documents.
This means that it might not be always appropriate to invoke - e.g. when your search filters are too liberal, you might attempt to download <strong>all</strong> documents from database.</p>
<p>Because of that, please be aware that this workaround might not work for all cases.
Next step could be to take the function and extend it to actually page the results.</p>
<h2>Recap</h2>
<p>In this entry we saw how we can workaround a third-part API limitation by writing a divide and conquer algorithm in F#. We also saw how pattern matching help us declare relevant logic in a nice and concise way.</p>
<p>Till next time, Merry Christmas!</p>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">type DocType =<br />&#160;&#160;| DocTypeA<br />&#160;&#160;| DocTypeB<br />&#160;&#160;| DocTypeC<br /><br />Full name: splittingdateranges.ThirdPartyApi.DocType</div>
<div class="tip" id="fs3">union case DocType.DocTypeA: DocType</div>
<div class="tip" id="fs4">union case DocType.DocTypeB: DocType</div>
<div class="tip" id="fs5">union case DocType.DocTypeC: DocType</div>
<div class="tip" id="fs6">type Document =<br />&#160;&#160;{DocId: int;<br />&#160;&#160;&#160;Type: DocType;<br />&#160;&#160;&#160;Created: DateTimeOffset;<br />&#160;&#160;&#160;Content: string;}<br /><br />Full name: splittingdateranges.ThirdPartyApi.Document</div>
<div class="tip" id="fs7">Document.DocId: int</div>
<div class="tip" id="fs8">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs9">Multiple items<br />Document.Type: DocType<br /><br />--------------------<br />type Type =<br />&#160;&#160;inherit MemberInfo<br />&#160;&#160;member Assembly : Assembly<br />&#160;&#160;member AssemblyQualifiedName : string<br />&#160;&#160;member Attributes : TypeAttributes<br />&#160;&#160;member BaseType : Type<br />&#160;&#160;member ContainsGenericParameters : bool<br />&#160;&#160;member DeclaringMethod : MethodBase<br />&#160;&#160;member DeclaringType : Type<br />&#160;&#160;member Equals : o:obj -&gt; bool + 1 overload<br />&#160;&#160;member FindInterfaces : filter:TypeFilter * filterCriteria:obj -&gt; Type[]<br />&#160;&#160;member FindMembers : memberType:MemberTypes * bindingAttr:BindingFlags * filter:MemberFilter * filterCriteria:obj -&gt; MemberInfo[]<br />&#160;&#160;...<br /><br />Full name: System.Type</div>
<div class="tip" id="fs10">Document.Created: DateTimeOffset</div>
<div class="tip" id="fs11">Multiple items<br />type DateTimeOffset =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;new : dateTime:DateTime -&gt; DateTimeOffset + 5 overloads<br />&#160;&#160;&#160;&#160;member Add : timeSpan:TimeSpan -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddDays : days:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddHours : hours:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddMilliseconds : milliseconds:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddMinutes : minutes:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddMonths : months:int -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddSeconds : seconds:float -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddTicks : ticks:int64 -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;member AddYears : years:int -&gt; DateTimeOffset<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.DateTimeOffset<br /><br />--------------------<br />DateTimeOffset()<br />DateTimeOffset(dateTime: DateTime) : unit<br />DateTimeOffset(ticks: int64, offset: TimeSpan) : unit<br />DateTimeOffset(dateTime: DateTime, offset: TimeSpan) : unit<br />DateTimeOffset(year: int, month: int, day: int, hour: int, minute: int, second: int, offset: TimeSpan) : unit<br />DateTimeOffset(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int, offset: TimeSpan) : unit<br />DateTimeOffset(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int, calendar: Globalization.Calendar, offset: TimeSpan) : unit</div>
<div class="tip" id="fs12">Document.Content: string</div>
<div class="tip" id="fs13">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs14">val baseDate : DateTimeOffset<br /><br />Full name: splittingdateranges.ThirdPartyApi.baseDate</div>
<div class="tip" id="fs15">Multiple items<br />type TimeSpan =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;new : ticks:int64 -&gt; TimeSpan + 3 overloads<br />&#160;&#160;&#160;&#160;member Add : ts:TimeSpan -&gt; TimeSpan<br />&#160;&#160;&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;&#160;&#160;member Days : int<br />&#160;&#160;&#160;&#160;member Duration : unit -&gt; TimeSpan<br />&#160;&#160;&#160;&#160;member Equals : value:obj -&gt; bool + 1 overload<br />&#160;&#160;&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;&#160;&#160;member Hours : int<br />&#160;&#160;&#160;&#160;member Milliseconds : int<br />&#160;&#160;&#160;&#160;member Minutes : int<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.TimeSpan<br /><br />--------------------<br />TimeSpan()<br />TimeSpan(ticks: int64) : unit<br />TimeSpan(hours: int, minutes: int, seconds: int) : unit<br />TimeSpan(days: int, hours: int, minutes: int, seconds: int) : unit<br />TimeSpan(days: int, hours: int, minutes: int, seconds: int, milliseconds: int) : unit</div>
<div class="tip" id="fs16">field TimeSpan.Zero</div>
<div class="tip" id="fs17">val documents : Document []<br /><br />Full name: splittingdateranges.ThirdPartyApi.documents</div>
<div class="tip" id="fs18">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : index:int64 -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs19">val init : count:int -&gt; initializer:(int -&gt; &#39;T) -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.init</div>
<div class="tip" id="fs20">val i : int</div>
<div class="tip" id="fs21">val index : int</div>
<div class="tip" id="fs22">val typ : DocType</div>
<div class="tip" id="fs23">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs24">type Type =<br />&#160;&#160;inherit MemberInfo<br />&#160;&#160;member Assembly : Assembly<br />&#160;&#160;member AssemblyQualifiedName : string<br />&#160;&#160;member Attributes : TypeAttributes<br />&#160;&#160;member BaseType : Type<br />&#160;&#160;member ContainsGenericParameters : bool<br />&#160;&#160;member DeclaringMethod : MethodBase<br />&#160;&#160;member DeclaringType : Type<br />&#160;&#160;member Equals : o:obj -&gt; bool + 1 overload<br />&#160;&#160;member FindInterfaces : filter:TypeFilter * filterCriteria:obj -&gt; Type[]<br />&#160;&#160;member FindMembers : memberType:MemberTypes * bindingAttr:BindingFlags * filter:MemberFilter * filterCriteria:obj -&gt; MemberInfo[]<br />&#160;&#160;...<br /><br />Full name: System.Type</div>
<div class="tip" id="fs25">TimeSpan.FromHours(value: float) : TimeSpan</div>
<div class="tip" id="fs26">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs27">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs28">type Filters =<br />&#160;&#160;{Type: DocType option;<br />&#160;&#160;&#160;CreatedBeforeOrEqual: DateTimeOffset option;<br />&#160;&#160;&#160;CreatedAfter: DateTimeOffset option;}<br /><br />Full name: splittingdateranges.ThirdPartyApi.Filters</div>
<div class="tip" id="fs29">Multiple items<br />Filters.Type: DocType option<br /><br />--------------------<br />type Type =<br />&#160;&#160;inherit MemberInfo<br />&#160;&#160;member Assembly : Assembly<br />&#160;&#160;member AssemblyQualifiedName : string<br />&#160;&#160;member Attributes : TypeAttributes<br />&#160;&#160;member BaseType : Type<br />&#160;&#160;member ContainsGenericParameters : bool<br />&#160;&#160;member DeclaringMethod : MethodBase<br />&#160;&#160;member DeclaringType : Type<br />&#160;&#160;member Equals : o:obj -&gt; bool + 1 overload<br />&#160;&#160;member FindInterfaces : filter:TypeFilter * filterCriteria:obj -&gt; Type[]<br />&#160;&#160;member FindMembers : memberType:MemberTypes * bindingAttr:BindingFlags * filter:MemberFilter * filterCriteria:obj -&gt; MemberInfo[]<br />&#160;&#160;...<br /><br />Full name: System.Type</div>
<div class="tip" id="fs30">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs31">Filters.CreatedBeforeOrEqual: DateTimeOffset option</div>
<div class="tip" id="fs32">Filters.CreatedAfter: DateTimeOffset option</div>
<div class="tip" id="fs33">val globalMaxLimit : int<br /><br />Full name: splittingdateranges.ThirdPartyApi.globalMaxLimit</div>
<div class="tip" id="fs34">val search : filters:Filters -&gt; Async&lt;Document []&gt;<br /><br />Full name: splittingdateranges.ThirdPartyApi.search</div>
<div class="tip" id="fs35">val filters : Filters</div>
<div class="tip" id="fs36">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs37">val results : Document []</div>
<div class="tip" id="fs38">val filter : predicate:(&#39;T -&gt; bool) -&gt; array:&#39;T [] -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.filter</div>
<div class="tip" id="fs39">val doc : Document</div>
<div class="tip" id="fs40">Filters.Type: DocType option</div>
<div class="tip" id="fs41">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs42">val t : DocType</div>
<div class="tip" id="fs43">Document.Type: DocType</div>
<div class="tip" id="fs44">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs45">val a : DateTimeOffset</div>
<div class="tip" id="fs46">val b : DateTimeOffset</div>
<div class="tip" id="fs47">property Array.Length: int</div>
<div class="tip" id="fs48">val take : count:int -&gt; array:&#39;T [] -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.take</div>
<div class="tip" id="fs49">val onlyDocA : ThirdPartyApi.Filters<br /><br />Full name: splittingdateranges.onlyDocA</div>
<div class="tip" id="fs50">module ThirdPartyApi<br /><br />from splittingdateranges</div>
<div class="tip" id="fs51">union case ThirdPartyApi.DocType.DocTypeA: ThirdPartyApi.DocType</div>
<div class="tip" id="fs52">val search : filters:ThirdPartyApi.Filters -&gt; Async&lt;ThirdPartyApi.Document []&gt;<br /><br />Full name: splittingdateranges.ThirdPartyApi.search</div>
<div class="tip" id="fs53">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task -&gt; Async&lt;unit&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member Choice : computations:seq&lt;Async&lt;&#39;T option&gt;&gt; -&gt; Async&lt;&#39;T option&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs54">static member Async.RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:Threading.CancellationToken -&gt; &#39;T</div>
<div class="tip" id="fs55">val results : ThirdPartyApi.Document []</div>
<div class="tip" id="fs56">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs57">type DateRange =<br />&#160;&#160;| Unbounded<br />&#160;&#160;| BeforeOrEqual of DateTimeOffset<br />&#160;&#160;| After of DateTimeOffset<br />&#160;&#160;| Between of DateTimeOffset * DateTimeOffset<br /><br />Full name: splittingdateranges.DateRange</div>
<div class="tip" id="fs58">union case DateRange.Unbounded: DateRange</div>
<div class="tip" id="fs59">union case DateRange.BeforeOrEqual: DateTimeOffset -&gt; DateRange</div>
<div class="tip" id="fs60">union case DateRange.After: DateTimeOffset -&gt; DateRange</div>
<div class="tip" id="fs61">union case DateRange.Between: DateTimeOffset * DateTimeOffset -&gt; DateRange</div>
<div class="tip" id="fs62">Multiple items<br />module Result<br /><br />from Microsoft.FSharp.Core<br /><br />--------------------<br />type Result&lt;&#39;a,&#39;b&gt; =<br />&#160;&#160;| Ok of &#39;a<br />&#160;&#160;| Error of &#39;b<br /><br />Full name: splittingdateranges.Result&lt;_,_&gt;</div>
<div class="tip" id="fs63">union case Result.Ok: &#39;a -&gt; Result&lt;&#39;a,&#39;b&gt;</div>
<div class="tip" id="fs64">union case Result.Error: &#39;b -&gt; Result&lt;&#39;a,&#39;b&gt;</div>
<div class="tip" id="fs65">type NoLimitSearchError =<br />&#160;&#160;| MinDateAfterNow of minDate: DateTimeOffset * now: DateTimeOffset<br />&#160;&#160;| MinTimeSpanExceeded of TimeSpan<br /><br />Full name: splittingdateranges.NoLimitSearchError</div>
<div class="tip" id="fs66">union case NoLimitSearchError.MinDateAfterNow: minDate: DateTimeOffset * now: DateTimeOffset -&gt; NoLimitSearchError</div>
<div class="tip" id="fs67">union case NoLimitSearchError.MinTimeSpanExceeded: TimeSpan -&gt; NoLimitSearchError</div>
<div class="tip" id="fs68">val minTimeSpan : TimeSpan<br /><br />Full name: splittingdateranges.minTimeSpan</div>
<div class="tip" id="fs69">TimeSpan.FromSeconds(value: float) : TimeSpan</div>
<div class="tip" id="fs70">val midBetween : dateA:DateTimeOffset -&gt; dateB:DateTimeOffset -&gt; Result&lt;DateTimeOffset,NoLimitSearchError&gt;<br /><br />Full name: splittingdateranges.midBetween</div>
<div class="tip" id="fs71">val dateA : DateTimeOffset</div>
<div class="tip" id="fs72">val dateB : DateTimeOffset</div>
<div class="tip" id="fs73">val diff : TimeSpan</div>
<div class="tip" id="fs74">val halfDiff : TimeSpan</div>
<div class="tip" id="fs75">property TimeSpan.Ticks: int64</div>
<div class="tip" id="fs76">val getNowDate : unit -&gt; DateTimeOffset<br /><br />Full name: splittingdateranges.getNowDate</div>
<div class="tip" id="fs77">property DateTimeOffset.UtcNow: DateTimeOffset</div>
<div class="tip" id="fs78">val split : minDate:DateTimeOffset -&gt; range:DateRange -&gt; Result&lt;&#39;a,NoLimitSearchError&gt;<br /><br />Full name: splittingdateranges.split</div>
<div class="tip" id="fs79">val minDate : DateTimeOffset</div>
<div class="tip" id="fs80">val range : DateRange</div>
<div class="tip" id="fs81">val now : DateTimeOffset</div>
<div class="tip" id="fs82">val dates : (DateTimeOffset -&gt; DateRange * DateRange)</div>
<div class="tip" id="fs83">val mid : DateTimeOffset</div>
<div class="tip" id="fs84">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; result:Result&lt;&#39;T,&#39;TError&gt; -&gt; Result&lt;&#39;U,&#39;TError&gt;<br /><br />Full name: Microsoft.FSharp.Core.Result.map</div>
<div class="tip" id="fs85">val fromFilters : filters:ThirdPartyApi.Filters -&gt; DateRange<br /><br />Full name: splittingdateranges.fromFilters</div>
<div class="tip" id="fs86">val filters : ThirdPartyApi.Filters</div>
<div class="tip" id="fs87">val before : DateTimeOffset option</div>
<div class="tip" id="fs88">ThirdPartyApi.Filters.CreatedBeforeOrEqual: DateTimeOffset option</div>
<div class="tip" id="fs89">val after : DateTimeOffset option</div>
<div class="tip" id="fs90">ThirdPartyApi.Filters.CreatedAfter: DateTimeOffset option</div>
<div class="tip" id="fs91">val before : DateTimeOffset</div>
<div class="tip" id="fs92">val after : DateTimeOffset</div>
<div class="tip" id="fs93">val apply : range:DateRange -&gt; filters:ThirdPartyApi.Filters -&gt; ThirdPartyApi.Filters<br /><br />Full name: splittingdateranges.apply</div>
<div class="tip" id="fs94">val searchNoLimit : minDate:DateTimeOffset -&gt; filters:ThirdPartyApi.Filters -&gt; Async&lt;Result&lt;ThirdPartyApi.Document [],NoLimitSearchError&gt;&gt;<br /><br />Full name: splittingdateranges.searchNoLimit</div>
<div class="tip" id="fs95">val search : (DateRange -&gt; Async&lt;Result&lt;ThirdPartyApi.Document [],NoLimitSearchError&gt;&gt;)</div>
<div class="tip" id="fs96">val filters&#39; : ThirdPartyApi.Filters</div>
<div class="tip" id="fs97">val firstRange : DateRange</div>
<div class="tip" id="fs98">val secondRange : DateRange</div>
<div class="tip" id="fs99">val results : Result&lt;ThirdPartyApi.Document [],NoLimitSearchError&gt; []</div>
<div class="tip" id="fs100">static member Async.Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;</div>
<div class="tip" id="fs101">val a : ThirdPartyApi.Document []</div>
<div class="tip" id="fs102">val b : ThirdPartyApi.Document []</div>
<div class="tip" id="fs103">val append : array1:&#39;T [] -&gt; array2:&#39;T [] -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.append</div>
<div class="tip" id="fs104">val e : NoLimitSearchError</div>
<div class="tip" id="fs105">val minDate : DateTimeOffset<br /><br />Full name: splittingdateranges.minDate</div>

  
  <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = "http://theimowski.com/blog/2017/12-17-splitting-date-ranges/index.html";
            this.page.identifier = "2017/12-17-splitting-date-ranges";
        };
        (function() {  // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            
            s.src = '//theimowski.disqus.com/embed.js';
            
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
